# yaml-language-server: $schema=https://raw.githubusercontent.com/smykla-labs/.github/main/schemas/sync-config.schema.json
---
# Unified Sync Configuration

sync:
  # Enable label removal to keep labels in sync with central config
  labels:
    allow_removal: true

  files:
    merge:
      - path: "renovate.json"
        strategy: "deep-merge"
        arrayStrategies:
          "$.extends": "append"
          "$.ignorePaths": "append"
          "$.packageRules": "append"
        overrides:
          # Dotfiles-specific extends (appended to org defaults)
          extends:
            - ":disableRateLimiting"
            - ":maintainLockFilesWeekly"

          # Dotfiles-specific ignore paths (appended to org defaults)
          ignorePaths:
            - "**/knowledge/**"
            - "**/secrets/**"
            - "**/todos/**"

          # Enable nix manager (dotfiles-specific)
          nix:
            enabled: true

          # Custom managers for nix files (dotfiles-specific)
          customManagers:
            - customType: "regex"
              datasourceTemplate: "github-releases"
              depNameTemplate: "stacklok/toolhive-studio"
              description: "Update ToolHive Studio version and hash in nix"
              extractVersionTemplate: "^v(?<version>.*)$"
              fileMatch: ["^nix/modules/home/toolhive-studio\\.nix$"]
              matchStrings:
                - "version = \"(?<currentValue>.*?)\";\\s+src = pkgs\\.fetchurl \\{\\s+url = \"https://github\\.com/stacklok/toolhive-studio/releases/download/v\\$\\{version\\}/ToolHive-arm64\\.dmg\";\\s+sha256 = \"(?<currentDigest>sha256-[A-Za-z0-9+/=]+|[a-f0-9]{52,64})\";"

          # Dotfiles-specific package rules (appended to org defaults)
          packageRules:
            - addLabels: ["mise"]
              automerge: true
              automergeType: "pr"
              description: "Automerge non-major mise updates via PR"
              matchManagers: ["mise"]
              matchUpdateTypes: ["minor", "patch"]
